SELECT
  FAMILIA,
  LINEA,
  IDARTICULO,
  ARTICULO,
  COSTO,
  PERIODO,
  MES,
  NOMBRE_MES,
  TIPO_ARTICULO,
  COUNT(*)
FROM(
SELECT
  FAM.DESCRIPCION AS FAMILIA,
  LIN.DESCRIPCION AS LINEA,
  ART.IDARTICULO,
  UPPER(ART.DESCRIPCION) AS ARTICULO,
  COS.COSTO,
  COS.PERIODO,
  COS.MES,
  COS.NOMBRE_MES,
  DECODE(ART.PRODUCCION,0,'MATERIA PRIMA',1,'ELABORABLE') AS TIPO_ARTICULO,
  COUNT(*)
FROM
  ARTICULO ART
INNER JOIN
  FAMILIAARTICULO FAM
  ON (FAM.IDFAMILIA = ART.IDFAMILIA)
INNER JOIN
  LINEA LIN
  ON (LIN.IDLINEA = ART.IDLINEA)
LEFT JOIN(
  SELECT COS.IDARTICULO, ROUND(COS.COSTO,0), EXTRACTYEAR(COS.FECHA), MES.MES, MES.NOMBRE_CORTO
  FROM COSTO_FINAL COS
  INNER JOIN MESES MES ON (MES.MES = EXTRACTMONTH(COS.FECHA))
  WHERE EXTRACTMONTH(COS.FECHA) BETWEEN :MES_DESDE AND :MES_HASTA
  AND EXTRACTYEAR(COS.FECHA) = :PERIODO
  ) COS (IDARTICULO, COSTO, PERIODO, MES, NOMBRE_MES)
  ON (COS.IDARTICULO = ART.IDARTICULO)
WHERE
  ART.IDFAMILIA  LIKE :FAMILIA_1
  AND ART.IDLINEA    LIKE :LINEA_1
  AND ART.IDARTICULO LIKE :ARTICULO_1
  AND COALESCE(ART.PRODUCCION,0) LIKE :RECETA_1
GROUP BY
  FAM.DESCRIPCION,
  LIN.DESCRIPCION,
  ART.IDARTICULO,
  UPPER(ART.DESCRIPCION),
  COS.COSTO,
  COS.PERIODO,
  COS.MES,
  COS.NOMBRE_MES,
  ART.PRODUCCION
)
(  FAMILIA,
  LINEA,
  IDARTICULO,
  ARTICULO,
  COSTO,
  PERIODO,
  MES,
  NOMBRE_MES,
  TIPO_ARTICULO,
  CONTADOR)
GROUP BY
  FAMILIA,
  LINEA,
  IDARTICULO,
  ARTICULO,
  COSTO,
  PERIODO,
  MES,
  NOMBRE_MES,
  TIPO_ARTICULO
ORDER BY
  FAMILIA,
  LINEA,
  ARTICULO,
  PERIODO DESC,
  MES DESC
